# ========================================
# PACKAGE.JSON - Backend
# ========================================

{
  "name": "evolution-qrcode-backend",
  "version": "1.0.0",
  "description": "Backend para exibir QR Code da Evolution API",
  "main": "backend-server.js",
  "scripts": {
    "start": "node backend-server.js",
    "dev": "nodemon backend-server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "axios": "^1.6.0",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}

# ========================================
# ARQUIVO .ENV - Configurações
# ========================================

# Evolution API Settings
EVOLUTION_API_URL=http://localhost:8080
EVOLUTION_API_KEY=sua-api-key-global-aqui

# Webhook Settings
WEBHOOK_BASE_URL=https://sua-plataforma.com
# Para testes locais com ngrok: https://abc123.ngrok.io

# Server Settings
PORT=3000
NODE_ENV=development

# ========================================
# INSTRUÇÕES DE INSTALAÇÃO
# ========================================

## Backend (Node.js)

1. Instalar dependências:
   npm install

2. Configurar .env:
   - Copie as variáveis acima para um arquivo .env
   - Preencha EVOLUTION_API_URL com o endereço da sua Evolution API
   - Preencha EVOLUTION_API_KEY com sua API key
   - Preencha WEBHOOK_BASE_URL com a URL pública do seu servidor

3. Para desenvolvimento local com webhook:
   - Instale ngrok: https://ngrok.com/
   - Execute: ngrok http 3000
   - Use a URL do ngrok em WEBHOOK_BASE_URL

4. Iniciar servidor:
   npm run dev  (desenvolvimento)
   npm start    (produção)

## Frontend (React)

1. Criar .env.local no projeto React:
   REACT_APP_API_URL=http://localhost:3000

2. Instalar no seu projeto React:
   - Copie QRCodeDisplay.jsx para src/components/
   - Copie QRCodeDisplay.css para src/components/

3. Usar no seu App:
   import QRCodeDisplay from './components/QRCodeDisplay';
   
   function App() {
     return <QRCodeDisplay instanceName="cliente123" />;
   }

# ========================================
# TESTANDO A IMPLEMENTAÇÃO
# ========================================

## 1. Criar uma instância

curl -X POST http://localhost:3000/api/instance/create \
  -H "Content-Type: application/json" \
  -d '{
    "instanceName": "teste123",
    "clientName": "Cliente Teste"
  }'

## 2. Verificar status

curl http://localhost:3000/api/status/teste123

## 3. Buscar QR Code

curl http://localhost:3000/api/qrcode/teste123

## 4. Listar todas as instâncias

curl http://localhost:3000/api/instances

## 5. Health check

curl http://localhost:3000/health

# ========================================
# FLUXO COMPLETO
# ========================================

1. Cliente acessa sua plataforma
2. Sistema chama POST /api/instance/create
3. Backend cria instância na Evolution API
4. Backend configura webhook
5. Evolution API gera QR Code
6. Evolution API envia webhook para /api/webhook/evolution
7. Backend armazena QR Code
8. Frontend faz polling em /api/qrcode/:instanceName
9. QR Code é exibido para o cliente
10. Cliente escaneia QR Code
11. WhatsApp conecta
12. Evolution API envia webhook CONNECTION_UPDATE
13. Frontend detecta conexão e redireciona

# ========================================
# DICAS DE PRODUÇÃO
# ========================================

## Segurança
- Use HTTPS obrigatoriamente
- Implemente autenticação JWT
- Valide origin dos webhooks
- Rate limiting nos endpoints
- Sanitize inputs

## Performance
- Use Redis para armazenar QR Codes
- Cache de status de conexão
- WebSocket ao invés de polling
- CDN para assets estáticos

## Monitoramento
- Logs estruturados (Winston/Pino)
- Métricas (Prometheus)
- APM (New Relic/DataDog)
- Health checks
- Alertas de falhas

## Backup
- Backup das instâncias
- Backup das credenciais
- Disaster recovery plan

# ========================================
# SOLUÇÃO DE PROBLEMAS COMUNS
# ========================================

## QR Code não aparece
1. Verificar se webhook está configurado
2. Verificar se webhook_base64: true
3. Verificar logs da Evolution API
4. Testar webhook com requestbin.com

## Webhook não recebe eventos
1. URL pública e acessível?
2. HTTPS configurado?
3. Firewall bloqueando?
4. Verificar DNS

## QR Code expira muito rápido
1. Implementar auto-refresh
2. Mostrar timer
3. Botão para gerar novo QR

## Múltiplas instâncias
1. Usar Redis/MongoDB
2. Implementar pool de conexões
3. Load balancer

# ========================================
# RECURSOS ADICIONAIS
# ========================================

- Documentação Evolution API: https://doc.evolution-api.com/
- GitHub: https://github.com/EvolutionAPI/evolution-api
- Comunidade Discord: [link no GitHub]
- Postman Collection: Disponível no GitHub

# ========================================
# SUPORTE
# ========================================

Para problemas com a Evolution API:
- Issues no GitHub
- Comunidade Discord
- Documentação oficial

Para problemas com este código:
- Verificar logs do servidor
- Verificar console do navegador
- Testar endpoints manualmente
