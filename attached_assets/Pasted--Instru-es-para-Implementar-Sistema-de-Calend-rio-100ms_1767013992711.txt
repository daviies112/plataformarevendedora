# ğŸš€ InstruÃ§Ãµes para Implementar Sistema de CalendÃ¡rio + 100ms

## ğŸ“ Estrutura de Arquivos

```
src/
â”œâ”€â”€ features/
â”‚   â””â”€â”€ reuniao-platform/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â””â”€â”€ CalendarioPage.tsx          # ARQUIVO 1
â”‚       â”œâ”€â”€ modals/
â”‚       â”‚   â””â”€â”€ CreateEventModal.tsx        # ARQUIVO 2
â”‚       â””â”€â”€ hooks/
â”‚           â””â”€â”€ useReuniao.ts               # ARQUIVO 5
â”‚
server/
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ meetings.ts                         # ARQUIVO 3 (NOVO)
â””â”€â”€ index.ts                                # ARQUIVO 4 (MODIFICAR)
```

---

## ğŸ”§ Passo a Passo de InstalaÃ§Ã£o

### 1ï¸âƒ£ Instalar DependÃªncias (se necessÃ¡rio)

```bash
npm install react-big-calendar date-fns @tanstack/react-query
```

---

### 2ï¸âƒ£ Substituir/Criar os Arquivos Frontend

#### **CalendarioPage.tsx**
- Caminho: `src/features/reuniao-platform/components/CalendarioPage.tsx`
- **AÃ§Ã£o**: SUBSTITUIR completamente o arquivo existente
- âœ… Corrige a tela preta
- âœ… Adiciona tratamento de erros robusto
- âœ… Sincroniza com a tabela `reunioes`

#### **CreateEventModal.tsx**
- Caminho: `src/features/reuniao-platform/modals/CreateEventModal.tsx`
- **AÃ§Ã£o**: SUBSTITUIR completamente o arquivo existente
- âœ… Envia dados para `/api/meetings` (rota correta)
- âœ… Usa formato ISO para datas (compatÃ­vel com PostgreSQL)
- âœ… Suporta reuniÃµes online (100ms) e presenciais

#### **useReuniao.ts**
- Caminho: `src/features/reuniao-platform/hooks/useReuniao.ts`
- **AÃ§Ã£o**: CRIAR ou SUBSTITUIR
- âœ… Hook com React Query para gerenciar estado
- âœ… Cache automÃ¡tico de 30 segundos
- âœ… Toasts de feedback

---

### 3ï¸âƒ£ Criar Rota de Backend

#### **meetings.ts**
- Caminho: `server/routes/meetings.ts`
- **AÃ§Ã£o**: CRIAR arquivo novo
- âœ… Endpoints REST completos (GET, POST, PUT, DELETE)
- âœ… ValidaÃ§Ã£o com Zod
- âœ… Multi-tenant seguro
- âœ… Logs detalhados

---

### 4ï¸âƒ£ Registrar Rota no Backend

#### **server/index.ts**
Adicione esta linha **APÃ“S** as outras rotas (ex: `/api/auth`, `/api/dashboard`):

```typescript
import meetingsRouter from './routes/meetings';

// ... outras configuraÃ§Ãµes ...

app.use('/api/meetings', meetingsRouter); // â† ADICIONAR ESTA LINHA

// ... resto do cÃ³digo ...
```

---

## âœ… Checklist de VerificaÃ§Ã£o

Antes de testar, verifique se:

- [ ] Todas as dependÃªncias foram instaladas (`react-big-calendar`, `date-fns`)
- [ ] O arquivo `CalendarioPage.tsx` foi substituÃ­do completamente
- [ ] O arquivo `CreateEventModal.tsx` foi substituÃ­do completamente
- [ ] O arquivo `useReuniao.ts` foi criado no caminho correto
- [ ] O arquivo `meetings.ts` foi criado em `server/routes/`
- [ ] A linha `app.use('/api/meetings', meetingsRouter)` foi adicionada ao `server/index.ts`
- [ ] O servidor foi reiniciado

---

## ğŸ§ª Como Testar

### **Teste 1: Criar ReuniÃ£o**
1. Acesse a pÃ¡gina `/calendario`
2. Clique no botÃ£o **"Nova ReuniÃ£o"**
3. Preencha os campos obrigatÃ³rios:
   - TÃ­tulo
   - Tipo (Online ou Presencial)
   - Data/Hora de InÃ­cio e Fim
4. Clique em **"Agendar ReuniÃ£o"**
5. âœ… Deve aparecer um toast de sucesso
6. âœ… A reuniÃ£o deve aparecer imediatamente no calendÃ¡rio

### **Teste 2: Visualizar no CalendÃ¡rio**
1. ApÃ³s criar a reuniÃ£o, verifique se ela aparece no grid do calendÃ¡rio
2. Clique sobre a reuniÃ£o
3. âœ… Deve mostrar um toast com os detalhes (horÃ¡rio, tipo, local)
4. âœ… Se for online, deve ter botÃ£o "Entrar na ReuniÃ£o 100ms"

### **Teste 3: ReuniÃµes da Home**
1. VÃ¡ para a pÃ¡gina inicial (onde lista as reuniÃµes)
2. Volte para `/calendario`
3. âœ… As reuniÃµes da home devem aparecer no calendÃ¡rio

---

## ğŸ› SoluÃ§Ã£o de Problemas Comuns

### âŒ **Erro: "Cannot find module 'react-big-calendar'"**
**SoluÃ§Ã£o:**
```bash
npm install react-big-calendar date-fns
```

---

### âŒ **Tela Preta no CalendÃ¡rio**
**Causa:** Erro de renderizaÃ§Ã£o por dados invÃ¡lidos  
**SoluÃ§Ã£o:** Verifique se vocÃª substituiu completamente o `CalendarioPage.tsx` (tem tratamento de erro)

---

### âŒ **ReuniÃµes nÃ£o aparecem**
**Causa:** Rota `/api/meetings` nÃ£o registrada  
**SoluÃ§Ã£o:**
1. Verifique se `server/routes/meetings.ts` existe
2. Verifique se `app.use('/api/meetings', meetingsRouter)` estÃ¡ no `server/index.ts`
3. Reinicie o servidor

---

### âŒ **Erro 401 (NÃ£o autenticado)**
**Causa:** `req.user` nÃ£o estÃ¡ definido  
**SoluÃ§Ã£o:** Verifique se o middleware de autenticaÃ§Ã£o estÃ¡ ativo:
```typescript
// Em server/index.ts
app.use(authMiddleware); // Deve vir ANTES das rotas
```

---

### âŒ **Erro ao criar reuniÃ£o: "Dados invÃ¡lidos"**
**Causa:** Payload nÃ£o estÃ¡ no formato esperado  
**SoluÃ§Ã£o:** Abra o console do navegador (F12) e verifique o payload enviado. Deve estar assim:
```json
{
  "titulo": "ReuniÃ£o Teste",
  "dataInicio": "2024-12-28T14:00:00.000Z",
  "dataFim": "2024-12-28T15:00:00.000Z",
  "duracao": 60,
  "nome": "online",
  "status": "agendada"
}
```

---

## ğŸ“Š Fluxo de Dados Completo

```
Frontend (CalendarioPage.tsx)
    â†“
useReuniao() hook
    â†“
React Query: fetch('/api/meetings')
    â†“
Backend (server/routes/meetings.ts)
    â†“
Database: SELECT * FROM reunioes WHERE tenant_id = ?
    â†“
Retorna JSON para frontend
    â†“
CalendÃ¡rio renderiza os eventos
```

---

## ğŸ¯ DiferenÃ§as do CÃ³digo Anterior

| Aspecto | âŒ CÃ³digo Antigo | âœ… CÃ³digo Novo |
|---------|------------------|----------------|
| **Rota** | `/api/dashboard/create-manual-event` (inexistente) | `/api/meetings` (funcional) |
| **Tabela** | Tentava usar tabela de eventos genÃ©rica | Usa `reunioes` (nativa do sistema) |
| **Formato de Data** | Strings inconsistentes | ISO 8601 (`.000Z`) |
| **Erro na Tela** | Tela preta sem feedback | Error boundary + logs |
| **IntegraÃ§Ã£o 100ms** | Esquecida | Integrada (campo `roomId100ms`) |
| **Multi-tenant** | NÃ£o verificava | Filtra por `tenantId` |

---

## ğŸ“ Suporte

Se ainda tiver problemas:
1. Abra o console do navegador (F12 â†’ Console)
2. Verifique os logs do servidor (terminal onde roda o backend)
3. Copie os erros e envie para anÃ¡lise

---

## âœ¨ Recursos Implementados

- âœ… CalendÃ¡rio visual completo
- âœ… Agendamento de reuniÃµes online (100ms) e presenciais
- âœ… SincronizaÃ§Ã£o em tempo real
- âœ… ValidaÃ§Ã£o de dados com Zod
- âœ… Feedback visual (toasts)
- âœ… Multi-tenant seguro
- âœ… Tratamento robusto de erros
- âœ… IntegraÃ§Ã£o com sistema 100ms existente

---

ğŸ‰ **Sistema pronto para uso!**